<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BULK SMS Pro</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        .modal-enter { animation: modalIn 0.3s ease-out forwards; }
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="bg-slate-900 min-h-screen font-sans text-slate-100 flex flex-col">

    <!-- Header -->
    <header class="bg-slate-800 shadow-sm border-b border-slate-700">
        <div class="max-w-3xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <i data-lucide="zap" class="text-blue-500 w-6 h-6"></i>
                <span class="font-bold text-xl text-white">SMS MANAGER</span>
            </div>
            <span class="text-xs font-semibold bg-slate-700 text-slate-300 px-3 py-1 rounded-full">@UL-SAOUD</span>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 w-full max-w-3xl mx-auto px-4 py-8">
        
        <div class="bg-slate-800 rounded-2xl shadow-sm border border-slate-700 p-6 sm:p-8 space-y-6">
            
            <!-- Phone Numbers Input -->
            <div>
                <div class="flex justify-between items-end mb-2">
                    <label class="block text-sm font-semibold text-slate-300">Phone Numbers</label>
                    <span class="text-xs font-medium text-slate-300 bg-slate-700 px-2 py-1 rounded"><span id="numberCount">0</span> Valid</span>
                </div>
                <textarea id="numbersInput" rows="6" class="w-full px-4 py-3 rounded-xl border border-slate-600 bg-slate-700 text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all outline-none resize-none font-mono text-sm" placeholder="9123473541&#10;7371043541&#10;9572827490"></textarea>
            </div>

            <!-- Message Input -->
            <div>
                <label class="block text-sm font-semibold text-slate-300 mb-2">Message Content</label>
                <textarea id="messageInput" rows="5" class="w-full px-4 py-3 rounded-xl border border-slate-600 bg-slate-700 text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all outline-none resize-none text-sm" placeholder="Type your message here..."></textarea>
            </div>

            <!-- Action Buttons -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 pt-2">
                <button onclick="openWhatsAppQueue()" class="flex items-center justify-center gap-2 bg-[#25D366] hover:bg-[#20bd5a] text-white font-semibold py-3.5 px-6 rounded-xl transition-all shadow-sm active:scale-95">
                    <i data-lucide="message-circle" class="w-5 h-5"></i>
                    Send via WhatsApp
                </button>
                <button onclick="sendBulkSMS()" class="flex items-center justify-center gap-2 bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3.5 px-6 rounded-xl transition-all shadow-sm active:scale-95">
                    <i data-lucide="message-square" class="w-5 h-5"></i>
                    Send via SMS
                </button>
            </div>

        </div>

    </main>

    <!-- WhatsApp Queue Modal (Hidden by default) -->
    <div id="queueModal" class="hidden fixed inset-0 z-50 bg-slate-950/80 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-2xl shadow-2xl w-full max-w-md overflow-hidden modal-enter flex flex-col max-h-[85vh] border border-slate-700">
            
            <!-- Modal Header -->
            <div class="px-6 py-4 border-b border-slate-700 flex justify-between items-center bg-slate-900/50">
                <h3 class="font-bold text-white flex items-center gap-2">
                    <i data-lucide="send" class="w-5 h-5 text-[#25D366]"></i>
                    WhatsApp Queue
                </h3>
                <button onclick="closeQueueModal()" class="text-slate-400 hover:text-white hover:bg-slate-700 p-1.5 rounded-lg transition-colors">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>

            <!-- Modal Body (Progress & List) -->
            <div class="p-6 overflow-y-auto flex-1">
                <div class="mb-4">
                    <div class="flex justify-between text-xs font-semibold text-slate-400 mb-1.5">
                        <span>Progress</span>
                        <span id="queueProgressText">0 / 0</span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-1.5">
                        <div id="queueProgressBar" class="bg-[#25D366] h-1.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>

                <ul id="queueList" class="space-y-2 mt-4">
                    <!-- Queue items will be injected here -->
                </ul>
            </div>

            <!-- Modal Footer -->
            <div class="p-6 border-t border-slate-700 bg-slate-800">
                <button onclick="processNextInQueue()" id="nextQueueBtn" class="w-full bg-[#25D366] hover:bg-[#20bd5a] text-white font-semibold py-3.5 px-4 rounded-xl transition-all flex justify-center items-center gap-2 shadow-sm active:scale-95">
                    <span>Send Next</span>
                    <i data-lucide="arrow-right" class="w-4 h-4"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-5 left-1/2 -translate-x-1/2 -translate-y-20 opacity-0 transition-all duration-300 bg-slate-700 text-white px-5 py-3 rounded-full shadow-lg border border-slate-600 flex items-center gap-2 z-[60]">
        <span id="toastMessage" class="text-sm font-medium">Notification</span>
    </div>

    <script>
        lucide.createIcons();

        // Variables
        let queue = [];
        let currentIndex = 0;
        let currentMessage = "";

        // Elements
        const numbersInput = document.getElementById('numbersInput');
        const numberCount = document.getElementById('numberCount');
        
        // Auto-Format Logic for 10-digit numbers
        numbersInput.addEventListener('input', function(e) {
            // Remove everything except digits
            let cleaned = this.value.replace(/\D/g, ''); 
            
            // Group by 10 digits per line
            let formatted = cleaned.match(/.{1,10}/g)?.join('\n') || '';
            
            // If user just typed the 10th digit, auto-add a new line
            if (cleaned.length > 0 && cleaned.length % 10 === 0 && e.inputType !== 'deleteContentBackward') {
                formatted += '\n';
            }
            
            this.value = formatted;
            
            // Update valid count (only counting exactly 10 digits)
            let validNumbers = formatted.split('\n').filter(n => n.length === 10);
            numberCount.textContent = validNumbers.length;
        });

        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = message;
            toast.classList.remove('-translate-y-20', 'opacity-0');
            setTimeout(() => toast.classList.add('-translate-y-20', 'opacity-0'), 2500);
        }

        function getValidNumbers() {
            const val = numbersInput.value;
            return val.split('\n').map(n => n.trim()).filter(n => n.length === 10);
        }

        // SMS Logic
        function sendBulkSMS() {
            const numbers = getValidNumbers();
            const message = document.getElementById('messageInput').value.trim();

            if (numbers.length === 0) return showToast('Please enter at least one 10-digit number.');
            if (!message) return showToast('Please enter message content.');

            const smsUri = `sms:${numbers.join(',')}?body=${encodeURIComponent(message)}`;
            window.location.href = smsUri;
        }

        // WhatsApp Modal Logic
        function openWhatsAppQueue() {
            const numbers = getValidNumbers();
            currentMessage = document.getElementById('messageInput').value.trim();

            if (numbers.length === 0) return showToast('Please enter at least one 10-digit number.');
            if (!currentMessage) return showToast('Please enter message content.');

            queue = numbers;
            currentIndex = 0;
            
            document.getElementById('queueModal').classList.remove('hidden');
            renderQueue();
        }

        function closeQueueModal() {
            document.getElementById('queueModal').classList.add('hidden');
        }

        function renderQueue() {
            const queueList = document.getElementById('queueList');
            const progressText = document.getElementById('queueProgressText');
            const progressBar = document.getElementById('queueProgressBar');
            const nextBtn = document.getElementById('nextQueueBtn');

            // Update Progress
            progressText.textContent = `${currentIndex} / ${queue.length}`;
            progressBar.style.width = `${(currentIndex / queue.length) * 100}%`;

            // Render List
            queueList.innerHTML = queue.map((num, index) => {
                let statusClass = 'text-slate-300 bg-slate-700 border-slate-600';
                let icon = '';
                
                if (index < currentIndex) {
                    statusClass = 'text-slate-500 bg-slate-800 border-transparent line-through';
                    icon = '<i data-lucide="check" class="w-4 h-4 text-[#25D366]"></i>';
                } else if (index === currentIndex) {
                    statusClass = 'text-blue-300 bg-blue-900/50 border-blue-700 font-semibold shadow-sm';
                    icon = '<i data-lucide="loader" class="w-4 h-4 text-blue-400 animate-spin"></i>';
                }

                return `
                    <li class="flex items-center justify-between p-3 rounded-lg border text-sm transition-all ${statusClass}">
                        <span>${num}</span>
                        ${icon}
                    </li>
                `;
            }).join('');

            lucide.createIcons();

            // Button State
            if (currentIndex >= queue.length) {
                nextBtn.innerHTML = `<span>Completed</span> <i data-lucide="check-circle" class="w-4 h-4"></i>`;
                nextBtn.classList.replace('bg-[#25D366]', 'bg-slate-700');
                nextBtn.classList.replace('hover:bg-[#20bd5a]', 'hover:bg-slate-600');
                nextBtn.disabled = true;
            } else {
                nextBtn.innerHTML = `<span>Send to ${queue[currentIndex]}</span> <i data-lucide="arrow-right" class="w-4 h-4"></i>`;
                nextBtn.classList.replace('bg-slate-700', 'bg-[#25D366]');
                nextBtn.classList.replace('hover:bg-slate-600', 'hover:bg-[#20bd5a]');
                nextBtn.disabled = false;
            }
        }

        function processNextInQueue() {
            if (currentIndex >= queue.length) return;

            const targetNumber = queue[currentIndex];
            // Automatically appending '91' for India as per requirements
            const waUrl = `https://wa.me/91${targetNumber}?text=${encodeURIComponent(currentMessage)}`;
            
            window.open(waUrl, '_blank');
            currentIndex++;
            renderQueue();
        }
    </script>
</body>
</html>